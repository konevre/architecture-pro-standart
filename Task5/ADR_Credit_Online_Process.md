### <a name="_b7urdng99y53"></a>**Название задачи:** 
Онлайн-кредитование: подача заявки, предодобренные предложения, интеграция с кредитным конвейером и скорингом

### <a name="_hjk0fkfyohdk"></a>**Автор:**
Команда цифровой трансформации

### <a name="_uanumrh8zrui"></a>**Дата:**
22.11.2025

---

### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Описаны Use Cases для процесса онлайн-кредитования.

| **№** | **Действующие лица или системы** | **Use Case** | **Описание** |
| :-: | :- | :- | :- |
| UC1 | Новый клиент, Сайт | Подача заявки на кредит (Lead) | Клиент заполняет короткую форму (ФИО, тел, паспорт) на сайте. Система проводит экспресс-скоринг и выдает предварительное решение. |
| UC2 | Клиент ИБ, Интернет-банк | Просмотр предодобренных предложений | Авторизованный клиент видит персональные предложения (сумма, ставка), рассчитанные заранее. |
| UC3 | Клиент ИБ, Интернет-банк | Подача полной заявки | Клиент выбирает предложение или вводит желаемую сумму, подтверждает заявку СМС-кодом. |
| UC4 | Credit Application Service (CAS), Скоринг | Онлайн-скоринг | Сервис заявок инициирует запрос в Скоринг, который обращается в БКИ и возвращает балл/решение. |
| UC5 | CAS, Кредитный конвейер | Передача заявки в бэк-офис | CAS передает созданную заявку в Кредитный конвейер (Camunda) для дальнейшей обработки андеррайтерами. |
| UC6 | CAS, SMS Gateway | Уведомление клиента | Отправка СМС со статусом заявки ("Одобрено", "Приходите в отделение" и т.д.). |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| **№** | **Требование** |
| :-: | :- |
| NFR1 | **Производительность:** Время экспресс-скоринга для нового клиента на сайте ≤ 1-2 сек. |
| NFR2 | **Масштабируемость:** Сервисы `CAS` и `Pre-approved Offers` должны масштабироваться горизонтально. |
| NFR3 | **Безопасность:** Все данные передаются по TLS 1.3; чувствительные данные (паспорт) не логируются в открытом виде. |
| NFR4 | **Надежность:** Асинхронная передача заявок в Кредитный конвейер (гарантия доставки). |
| NFR5 | **Интеграция:** Отказ от интеграции через БД (DB Link) между АБС/ИБ и Конвейером в онлайн-процессе. |
| NFR6 | **Ограничения БКИ:** Учитывать стоимость и лимиты запросов в БКИ (не бомбить запросами на каждый чих). |

### <a name="_qmphm5d6rvi3"></a>**Решение**

#### Концептуальная архитектура

Для реализации кредитного процесса вводятся два ключевых микросервиса:

1.  **Credit Application Service (CAS):** "Оркестратор" заявки. Принимает запрос с фронта, ходит в Скоринг, сохраняет черновик, пушит в Кредитный конвейер.
2.  **Pre-approved Offers Service (PAOS):** Сервис "витрины" предложений. Хранит готовые предложения (рассчитанные ночными batch-процессами) и быстро отдает их в ИБ.

#### Диаграммы C4

**1. Диаграмма Контекста (Context):** `C4_Context.puml`
Показывает взаимодействие клиентов с каналами и новых сервисов с внешними системами (БКИ) и внутренним бэкендом (Конвейер, Скоринг).

**2. Диаграмма Компонентов (Component):** `C4_Component.puml`
Детализирует внутреннее устройство сервисов:
*   **CAS:** API, клиенты к внешним системам, БД заявок.
*   **PAOS:** API, калькулятор предложений (при необходимости дорасчета), БД предложений.

#### Логика выбора
*   **Выделение PAOS:** Чтобы не нагружать основной скоринг каждый раз, когда клиент заходит в ИБ, предложения рассчитываются заранее и кэшируются в отдельном сервисе.
*   **CAS как шлюз:** Изолирует сложную логику Camunda и АБС от легкого фронтенда Сайта/ИБ.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

| Альтернатива | Описание | Плюсы | Минусы |
| :--- | :--- | :--- | :--- |
| **Прямой вызов Скоринга с фронта** | Сайт дергает API Скоринга напрямую. | Быстро (нет прослойки). | Опасно (Security); сложно управлять логикой (оркестрация БКИ, проверок). |
| **Использование АБС** | Вся логика заявок в АБС. | Единая база. | АБС перегружена и не масштабируется; медленная разработка. |
| **Все в Camunda** | Сайт дергает API Camunda напрямую. | Camunda сама ведет процесс. | Camunda тяжелая для high-load фронтенда; лицензионные ограничения (если есть). CAS легче и быстрее. |

### **Недостатки, ограничения, риски**

1.  **Рассинхрон предложений:** Данные в PAOS могут устареть (клиент уже взял кредит в другом месте), если пересчет идет только раз в сутки. Требуется проверка актуальности перед выдачей (Final Check).
2.  **Зависимость от БКИ:** Если БКИ лежит, онлайн-скоринг на сайте не работает. Нужен Failover (например, принимать заявку, но решение давать позже).
3.  **Сложность идентификации:** Новые клиенты с сайта все равно должны идти в офис (115-ФЗ), что снижает конверсию.
