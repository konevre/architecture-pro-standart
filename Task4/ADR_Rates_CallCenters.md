### <a name="_b7urdng99y53"></a>**Название задачи:** 
Обеспечение доступа кол-центров (внутреннего и партнёрского) к актуальным ставкам депозитов

### <a name="_hjk0fkfyohdk"></a>**Автор:**
Архитектор (Команда цифровой трансформации)

### <a name="_uanumrh8zrui"></a>**Дата:**
22.11.2025

---

### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Описаны Use Cases для предоставления ставок операторам кол-центров.

| **№** | **Действующие лица или системы** | **Use Case** | **Описание** |
| :-: | :- | :- | :- |
| UC1 | Оператор КЦ банка, Система КЦ, Сервис ставок | Консультация по ставкам (Внутренний КЦ) | Оператор КЦ банка видит актуальные ставки в своем интерфейсе. Данные подтягиваются онлайн через API из Сервиса ставок. |
| UC2 | Оператор партнёрского КЦ, Система партнера | Консультация по ставкам (Партнёр) | Оператор партнера использует ставки, загруженные в их систему из файла. Обновление происходит раз в сутки (или по событию). |
| UC3 | Сервис ставок, SFTP/File Server | Экспорт ставок для партнера | Система автоматически формирует JSON-файл с актуальными ставками и выкладывает его на защищенный ресурс (SFTP) для партнера. |
| UC4 | Менеджер бэк-офиса, Сервис ставок | Управление ставками | Менеджер вводит новые ставки в едином интерфейсе. После утверждения они становятся доступны и для API (свой КЦ), и для выгрузки (партнер). |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| **№** | **Требование** |
| :-: | :- |
| NFR1 | **Актуальность (Свой КЦ):** Изменения ставок должны быть доступны операторам банка в режиме реального времени (секунды). |
| NFR2 | **Актуальность (Партнер):** Задержка обновления у партнера не более 1 рабочего дня (или по расписанию выгрузки). |
| NFR3 | **Интеграция с партнером:** Только файловый обмен (JSON). Прямой API доступ запрещен (Security/Network policy). |
| NFR4 | **Формат:** JSON-файл фиксированной структуры, версионируемый. |
| NFR5 | **Безопасность:** Передача файла через защищенный канал (SFTP с шифрованием или VPN). |
| NFR6 | **Отказоустойчивость:** Сервис ставок должен выдерживать нагрузку от звонков КЦ (кэширование на стороне клиента КЦ). |

### <a name="_qmphm5d6rvi3"></a>**Решение**

#### Концептуальная архитектура

Решение базируется на **Сервисе Ставок (Rates Service)**, спроектированном в рамках MVP, с расширением функционала для КЦ.

1.  **Единый источник:** Сервис ставок хранит эталонные данные.
2.  **Внутренний контур (Свой КЦ):** Система кол-центра банка интегрируется с Сервисом ставок по **REST API** (синхронно). Это обеспечивает максимальную актуальность. Чтобы не перегрузить сервис, на стороне КЦ реализуется кратковременное кэширование (TTL 5-10 мин).
3.  **Внешний контур (Партнёр):** Реализуется асинхронный процесс **Export Job**.
    *   По расписанию (или триггеру) формируется JSON.
    *   Файл отправляется на **SFTP-сервер** (в DMZ или на стороне партнера).
    *   Партнер забирает файл и импортирует в свою систему.

#### Диаграммы C4

**1. Диаграмма Контекста (Context):** `C4_Context_Rates_CallCenters.puml`
Показывает потоки данных: API вызовы от внутреннего КЦ и передачу файлов через SFTP партнеру.

**2. Диаграмма Компонентов (Component):** `C4_Component_Rates_CallCenters.puml`
Детализирует Сервис ставок:
*   `RatesAPI` — для онлайна.
*   `RatesExportJob` — фоновая задача для генерации файлов.
*   `RatesAdminUI` — управление ставками.

#### Логика выбора
*   **SFTP/Файлы для партнера:** Выбрано из-за ограничений партнера ("нет возможности сделать API-вызовы") и требований безопасности (не открывать внутренний API наружу).
*   **API для своего КЦ:** Позволяет давать операторам самую свежую информацию мгновенно, что критично при частой смене ставок.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

| Альтернатива | Описание | Плюсы | Минусы |
| :--- | :--- | :--- | :--- |
| **API для партнера** | Партнер вызывает наш REST API. | Данные онлайн. | Требует открытия доступа во внутреннюю сеть (риск); партнер не готов технически. |
| **Ручная отправка Excel** | Менеджер шлет Excel почтой партнеру. | Дешево, не нужна разработка. | Человеческий фактор (забыл, ошибся); сложно парсить Excel автоматически на стороне партнера. |
| **Дублирование ввода** | Менеджеры вводят ставки и в АБС, и в систему КЦ. | Нет интеграции. | Высокий риск рассинхрона данных; двойная работа. |

### **Недостатки, ограничения, риски**

1.  **Задержка данных у партнера:** Операторы партнера могут консультировать по "вчерашним" ставкам, если файл еще не загружен. Требуется организационный регламент (предупреждать клиентов о дате актуальности).
2.  **Сложность поддержки версий:** При изменении структуры ставок придется согласовывать новый формат JSON с партнером и синхронизировать релизы.
3.  **Нагрузка на API:** В пиковые часы (маркетинговая акция) звонки могут создать DDOS-эффект на Сервис ставок. Обязательно кэширование.
